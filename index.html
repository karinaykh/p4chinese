<!DOCTYPE html>
<html lang="zh-Hant-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°å­¸ä¸­æ–‡è©å½™æŒ‘æˆ° (è¶£å‘³å‡ç´šç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", "KaiTi", "DFKai-SB", "PMingLiU", "MingLiU";
            background-color: #f0f9ff; /* Default light blue background */
            transition: background-color 0.5s ease;
            overflow-x: hidden; /* Prevent horizontal scroll from animations */
        }
        .game-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }
        .question-item {
            margin-bottom: 1.5rem;
            padding: 1.25rem;
            background-color: #e0f2fe;
            border-radius: 8px;
            border-left: 5px solid #0ea5e9;
        }
        .answer-input {
            border: 2px solid #9ca3af;
            border-radius: 6px;
            padding: 0.5rem 0.75rem;
            margin: 0 0.25rem;
            width: 160px; /* Slightly wider for 4-char idioms */
            transition: border-color 0.3s, transform 0.3s;
        }
        .answer-input:focus {
            outline: none;
            border-color: #3b82f6;
        }
        .feedback-icon {
            font-size: 1.25rem;
            margin-left: 0.5rem;
            vertical-align: middle;
        }
        .correct .answer-input {
            border-color: #22c55e;
            background-color: #f0fdf4;
            animation: pop 0.4s ease-out;
        }
        .incorrect .answer-input {
            border-color: #ef4444;
            background-color: #fef2f2;
            animation: shake 0.5s;
        }
        .correct .feedback-icon::after {
            content: 'âœ”ï¸';
            color: #22c55e;
        }
        .incorrect .feedback-icon::after {
            content: 'âŒ';
            color: #ef4444;
        }
        .explanation {
            font-size: 0.9rem;
            color: #4b5563;
            margin-top: 0.5rem;
            padding: 0.5rem;
            background-color: #f9fafb;
            border-radius: 4px;
            border-left: 3px solid #ef4444;
        }
        .explanation .correct-answer {
            font-weight: bold;
            color: #16a34a;
        }
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            transition: background-color 0.3s, transform 0.1s;
            cursor: pointer;
            border: none;
        }
        .btn:active {
            transform: translateY(1px);
        }
        .btn-primary {
            background-color: #3b82f6; /* Blue */
            color: white;
        }
        .btn-primary:hover {
            background-color: #2563eb;
        }
        .btn-secondary {
            background-color: #6b7280; /* Gray */
            color: white;
        }
        .btn-secondary:hover {
            background-color: #4b5563;
        }
        .btn-difficulty {
            background-color: #10b981; /* Emerald green */
            color: white;
            margin: 0.5rem;
            width: 180px; /* Slightly wider button */
            font-size: 1.1rem;
        }
        .btn-difficulty:hover {
            background-color: #059669;
        }
        #score-area {
            margin-top: 1.5rem;
            font-size: 1.25rem;
            font-weight: bold;
            color: #1d4ed8; /* Darker blue for score text */
        }
        #difficulty-selection {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 2rem;
        }

        /* Score Progress Bar */
        #score-progress-bar-container {
            width: 100%;
            background-color: #e5e7eb; /* Lighter gray */
            border-radius: 9999px; /* pill shape */
            height: 1.75rem; /* 28px */
            margin-top: 0.75rem; /* 12px */
        }
        #score-progress-bar {
            background-color: #34d399; /* Emerald 500 */
            height: 100%;
            border-radius: 9999px;
            text-align: center;
            color: white;
            font-weight: 500;
            line-height: 1.75rem; /* same as height */
            transition: width 0.5s ease-in-out;
        }
        /* Streak Counter */
        #perfect-round-streak-counter {
            font-size: 1.125rem; /* text-lg */
            font-weight: 600; /* font-semibold */
            color: #f59e0b; /* amber-500 */
            margin-top: 0.75rem; /* mt-3 */
            text-align: center;
        }

        /* Animations */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-6px); }
            40%, 80% { transform: translateX(6px); }
        }
        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.08); }
            100% { transform: scale(1); }
        }

        /* Mobile responsiveness */
        @media (max-width: 600px) {
            .answer-input {
                width: 130px;
            }
            .game-container {
                margin: 1rem;
                padding: 1rem;
            }
            h1 {
                font-size: 1.6rem; /* Slightly larger */
            }
            .btn-difficulty {
                width: 100%;
                font-size: 1rem;
            }
            .text-lg { 
                font-size: 1rem; 
            }
             #score-progress-bar-container {
                height: 1.5rem; /* Slightly smaller on mobile */
            }
            #score-progress-bar {
                line-height: 1.5rem;
            }
        }
    </style>
</head>
<body class="text-gray-800">
    <div class="game-container">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-sky-700">å°å­¸ä¸­æ–‡è©å½™æŒ‘æˆ°</h1>
            <p class="mt-2 text-gray-600">ï¼ˆé¦™æ¸¯å°å­¸å››å¹´ç´šé©ç”¨ï¼‰</p>
        </header>

        <section id="difficulty-selection">
            <h2 class="text-xl font-semibold mb-4 text-gray-700">è«‹é¸æ“‡æŒ‘æˆ°ç´šåˆ¥ï¼š</h2>
            <button class="btn btn-difficulty" data-difficulty="easy">åŸºç¤ç´š</button>
            <button class="btn btn-difficulty" data-difficulty="medium">é€²éšç´š</button>
            <button class="btn btn-difficulty" data-difficulty="hard">æŒ‘æˆ°ç´š</button>
        </section>

        <section id="game-content" class="hidden">
            <section id="instructions" class="mb-6 text-gray-700">
                <p>å°æŒ‘æˆ°è€…ï¼Œè«‹å–ºä¸‹é¢å¥å­å˜…æ‹¬è™Ÿå…¥é¢ï¼Œå¡«ä¸Šæœ€å•±å˜…è©èªæˆ–æˆèªå•¦ï¼å®Œæˆ<span id="questions-count-in-round" class="font-bold text-blue-600"></span>æ¢é¡Œç›®å¾Œï¼Œæ’³ã€Œ<span class="font-semibold text-blue-600">æª¢æŸ¥ç­”æ¡ˆ</span>ã€ï¼</p>
            </section>
            
            <section id="game-area">
                </section>

            <div id="score-progress-bar-container" class="hidden">
                <div id="score-progress-bar" style="width: 0%;">0/0</div>
            </div>
            <div id="perfect-round-streak-counter" class="hidden">ğŸ† é€£çºŒå®Œç¾å›åˆï¼š<span id="perfect-round-streak-count">0</span> æ¬¡ï¼</div>


            <section id="controls" class="mt-8 flex flex-col sm:flex-row justify-center items-center space-y-2 sm:space-y-0 sm:space-x-4">
                <button id="check-button" class="btn btn-primary w-full sm:w-auto">æª¢æŸ¥ç­”æ¡ˆ</button>
                <button id="reset-level-button" class="btn btn-secondary w-full sm:w-auto">è¿”å›é¸æ“‡ç´šåˆ¥</button>
            </section>
            <section id="score-area" class="text-center mt-6">
                </section>
        </section>
    </div>

    <script>
        const allQuestions = { // Using the same questions as previous correct answer
            easy: [
                { text_before: "1. æ‰“å¥½ä¸­æ–‡ï¼ˆ", text_after: "ï¼‰å°å­¸ç¿’å…¶ä»–ç§‘ç›®å¾ˆæœ‰å¹«åŠ©ã€‚", answer: "åŸºç¤", explanation: "åŸºç¤: äº‹ç‰©ç™¼å±•çš„æ ¹æœ¬æˆ–èµ·é»ã€‚" },
                { text_before: "2. åšäº‹è¦å…ˆï¼ˆ", text_after: "ï¼‰æ¸…æ¥šï¼Œä¸è¦é­¯è½è¡Œäº‹ã€‚", answer: "è€ƒæ…®", explanation: "è€ƒæ…®: æ€è€ƒå•é¡Œï¼Œä»¥ä¾¿ä½œå‡ºæ±ºå®šã€‚" },
                { text_before: "3. é€™æ¢å°æºªçš„æºªæ°´ï¼ˆ", text_after: "ï¼‰è¦‹åº•ï¼Œéå¸¸ä¹¾æ·¨ã€‚", answer: "æ¸…æ¾ˆ", explanation: "æ¸…æ¾ˆ: æ°´æ¸…è€Œé€æ˜ã€‚" },
                { text_before: "4. ç¾ä»£ï¼ˆ", text_after: "ï¼‰æ—¥æ–°æœˆç•°ï¼Œæ”¹è®Šäº†æˆ‘å€‘çš„ç”Ÿæ´»ã€‚", answer: "ç§‘æŠ€", explanation: "ç§‘æŠ€: ç§‘å­¸æŠ€è¡“ã€‚" },
                { text_before: "5. å¦‚æœä¸å°å¿ƒï¼Œå¾ˆå®¹æ˜“åœ¨å°äº‹ä¸Šï¼ˆ", text_after: "ï¼‰ã€‚", answer: "åƒè™§", explanation: "åƒè™§: å—åˆ°æå¤±æˆ–ä¸å…¬å¹³çš„å¾…é‡ã€‚" },
                { text_before: "6. åª½åª½æº–å‚™äº†è±å¯Œçš„ï¼ˆ", text_after: "ï¼‰ä¾†åšæ™šé¤ã€‚", answer: "ææ–™", explanation: "ææ–™: å¯ä¾›è£½ä½œæˆå“æˆ–é”åˆ°æŸç¨®ç›®çš„çš„æ±è¥¿ã€‚" },
                { text_before: "7. å°æ˜ä¸å°å¿ƒï¼ˆ", text_after: "ï¼‰äº†ä¸€è·¤ï¼Œè†è“‹æ“¦å‚·äº†ã€‚", answer: "æ‘”", explanation: "æ‘”: è·Œå€’ã€‚" },
                { text_before: "8. é‡åˆ°å›°é›£æ™‚ï¼Œæˆ‘å€‘ä¸æ‡‰è¼•æ˜“ï¼ˆ", text_after: "ï¼‰ã€‚", answer: "æ”¾æ£„", explanation: "æ”¾æ£„: ä¸å†å …æŒæˆ–ä¸Ÿæ‰ã€‚" },
                { text_before: "9. è€å¸«å°æˆ‘å€‘çš„è¦æ±‚ååˆ†ï¼ˆ", text_after: "ï¼‰ï¼Œå¸Œæœ›æˆ‘å€‘é€²æ­¥ã€‚", answer: "åš´å²", explanation: "åš´å²: åš´æ ¼è€Œå²å®³ã€‚" },
                { text_before: "10. å°è¯æ‹¾é‡‘ä¸æ˜§çš„è¡Œç‚ºå¾—åˆ°äº†å¤§å®¶çš„ï¼ˆ", text_after: "ï¼‰ã€‚", answer: "ç¨±è®š", explanation: "ç¨±è®š: è¡¨ç¤ºå°å¥½äººå¥½äº‹çš„è®šæšã€‚" },
                { text_before: "11. å¥¶å¥¶ç”¨æº«æš–çš„æ‰‹ï¼ˆ", text_after: "ï¼‰ç€æˆ‘çš„é ­ã€‚", answer: "è¼•æ’«", explanation: "è¼•æ’«: è¼•è¼•åœ°æ’«æ‘¸ã€‚" },
                { text_before: "12. åœ¨å…¬å…±å ´æ‰€ï¼Œæˆ‘å€‘æ‡‰ï¼ˆ", text_after: "ï¼‰ç…§é¡§è€å¼±å©¦å­ºã€‚", answer: "å„ªå…ˆ", explanation: "å„ªå…ˆ: å…ˆè€ƒæ…®æˆ–å…ˆè™•ç†ã€‚" },
                { text_before: "13. è²“å…’ï¼ˆ", text_after: "ï¼‰ç€çª—å¤–é£›éçš„å°é³¥ã€‚", answer: "æ³¨è¦–", explanation: "æ³¨è¦–: é›†ä¸­ç›®å…‰çœ‹ã€‚" },
                { text_before: "14. è«‹ä¸è¦éš¨åœ°ï¼ˆ", text_after: "ï¼‰åƒåœ¾ï¼Œä¿æŒç’°å¢ƒæ¸…æ½”ã€‚", answer: "ä¸Ÿæ£„", explanation: "ä¸Ÿæ£„: æ‰”æ‰ä¸è¦çš„æ±è¥¿ã€‚" },
                { text_before: "15. æˆ‘å–œæ­¡åœ¨ç©ºé–’æ™‚å’Œæœ‹å‹ï¼ˆ", text_after: "ï¼‰ï¼Œåˆ†äº«ç”Ÿæ´»é»æ»´ã€‚", answer: "èŠå¤©", explanation: "èŠå¤©: éš¨ä¾¿è«‡è©±ã€‚" },
                { text_before: "16. é›–ç„¶ä»–å‹•ä½œæœ‰äº›ï¼ˆ", text_after: "ï¼‰ï¼Œä½†ä»–å¾ˆåŠªåŠ›å­¸ç¿’ã€‚", answer: "ç¬¨æ‹™", explanation: "ç¬¨æ‹™: ä¸éˆæ´»ï¼›ä¸è°æ˜ã€‚" }
            ],
            medium: [
                { text_before: "1. æˆ‘å€‘è¦ç‚ºå°‡ä¾†åšå¥½ï¼ˆ", text_after: "ï¼‰ï¼Œæ‰èƒ½æ‡‰å°å„ç¨®è®ŠåŒ–ã€‚", answer: "è¨­æƒ³", explanation: "è¨­æƒ³: æƒ³åƒã€å‡æƒ³ã€‚" },
                { text_before: "2. é€™é …ç™¼æ˜å·²ç²å¾—äº†åœ‹å®¶ï¼ˆ", text_after: "ï¼‰ï¼Œå—åˆ°æ³•å¾‹ä¿è­·ã€‚", answer: "å°ˆåˆ©", explanation: "å°ˆåˆ©: æŒ‡åœ‹å®¶ä¾æ³•åœ¨ä¸€å®šæ™‚æœŸå…§æˆäºˆç™¼æ˜è€…æˆ–å…¶æ¬Šåˆ©ç¹¼æ‰¿äººå°æŸé …ç™¼æ˜å‰µé€ æ‰€ç¨äº«çš„æ¬Šåˆ©ã€‚" },
                { text_before: "3. é‹å‹•å“¡æ†‘ç€ï¼ˆ", text_after: "ï¼‰çš„æ„å¿—ï¼Œå®Œæˆäº†è‰±è‹¦çš„è¨“ç·´ã€‚", answer: "å …æ¯…", explanation: "å …æ¯…: å …å®šæœ‰æ¯…åŠ›ã€‚" },
                { text_before: "4. è‰¯å¥½çš„å“å¾·æ˜¯ä¸€å€‹äººæœ€å¤§çš„ï¼ˆ", text_after: "ï¼‰ã€‚", answer: "åˆ©ç›Š", explanation: "åˆ©ç›Š: å¥½è™•ã€‚ï¼ˆæ­¤è™•å¯å¼•å°å­¸ç”Ÿæ€è€ƒæ›´å»£æ³›çš„ã€Œå¥½è™•ã€ï¼‰" },
                { text_before: "5. éƒµå·®æ¯å¤©æº–æ™‚æŠŠä¿¡ä»¶ï¼ˆ", text_after: "ï¼‰åˆ°å„å®¶å„æˆ¶ã€‚", answer: "å‚³é€", explanation: "å‚³é€: å‚³éé€é”ã€‚" },
                { text_before: "6. æˆ‘æ”¶åˆ°ä¸€å‰‡é‡è¦çš„ï¼ˆ", text_after: "ï¼‰ï¼Œéœ€è¦é¦¬ä¸Šè™•ç†ã€‚", answer: "è¨Šæ¯", explanation: "è¨Šæ¯: æ¶ˆæ¯ã€ä¿¡æ¯ã€‚" },
                { text_before: "7. æˆ‘å€‘è¦æŠŠå­¸åˆ°çš„çŸ¥è­˜ï¼ˆ", text_after: "ï¼‰åˆ°å¯¦éš›ç”Ÿæ´»ä¸­ã€‚", answer: "æ‡‰ç”¨", explanation: "æ‡‰ç”¨: ä½¿ç”¨ï¼ˆçŸ¥è­˜ã€ç†è«–ã€æ–¹æ³•ç­‰ï¼‰ã€‚" },
                { text_before: "8. ä¸è¦è¢«ç”œè¨€èœœèªæ‰€ï¼ˆ", text_after: "ï¼‰ï¼Œè¦ä¿æŒæ¸…é†’çš„é ­è…¦ã€‚", answer: "å¼•èª˜", explanation: "å¼•èª˜: ç”¨æŸç¨®æ‰‹æ®µèª˜ä½¿äººåšæŸäº‹ï¼ˆå¤šæŒ‡å£äº‹ï¼‰ã€‚" },
                { text_before: "9. ä»–ï¼ˆ", text_after: "ï¼‰æ€è€ƒé€™å€‹å•é¡Œï¼Œå¸Œæœ›èƒ½æ‰¾åˆ°ç­”æ¡ˆã€‚", answer: "åè¦†", explanation: "åè¦†: ä¸€éåˆä¸€éï¼›å¤šæ¬¡é‡è¤‡ã€‚" },
                { text_before: "10. é€™ç¯‡æ–‡ç« çš„é¢¨æ ¼æœ‰äº›ï¼ˆ", text_after: "ï¼‰ï¼Œä¸å¤ ç”Ÿå‹•æœ‰è¶£ã€‚", answer: "å‘†æ¿", explanation: "å‘†æ¿: ä¸è‡ªç„¶ï¼›ä¸ç”Ÿå‹•ã€‚" },
                { text_before: "11. äººç”Ÿé›£å…æœƒé‡åˆ°ï¼ˆ", text_after: "ï¼‰ï¼Œé‡è¦çš„æ˜¯å¦‚ä½•é¢å°ã€‚", answer: "æŒ«æŠ˜", explanation: "æŒ«æŠ˜: å¤±æ•—ã€å¤±åˆ©ã€‚" },
                { text_before: "12. å­¸æ ¡å°å­¸ç”Ÿçš„è¡Œç‚ºæœ‰ï¼ˆ", text_after: "ï¼‰çš„è¦å®šã€‚", answer: "åš´æ ¼", explanation: "åš´æ ¼: åœ¨åŸ·è¡Œåˆ¶åº¦æˆ–æŒæ¡æ¨™æº–æ™‚ä¸æ”¾é¬†ã€‚" },
                { text_before: "13. é¢å°å›°é›£ï¼Œæˆ‘å€‘è¦ï¼ˆ", text_after: "ï¼‰ç©æ¥µçš„æªæ–½ä¾†è§£æ±ºã€‚", answer: "æ¡å–", explanation: "æ¡å–: é¸å–æ–½è¡Œï¼ˆæ–¹é‡ã€æ”¿ç­–ã€æªæ–½ã€æ‰‹æ®µç­‰ï¼‰ã€‚" },
                { text_before: "14. é€™ä½é­”è¡“å¸«çš„è¡¨æ¼”çœŸï¼ˆ", text_after: "ï¼‰ï¼Œè®“è§€çœ¾ç›®çªå£å‘†ã€‚", answer: "å²å®³", explanation: "å²å®³: é›£ä»¥å°ä»˜æˆ–å¿å—ï¼›åŠ‡çƒˆï¼›çŒ›çƒˆï¼›äº†ä¸èµ·ã€‚" },
                { text_before: "15. ç¶“éå¤šå¹´çš„åŠªåŠ›ï¼Œä»–çµ‚æ–¼åœ¨ç§‘å­¸ç•Œï¼ˆ", text_after: "ï¼‰ã€‚", answer: "æˆå", explanation: "æˆå: ç²å¾—åè­½æˆ–åè²ã€‚" },
                { text_before: "16. æ”€ç™»é«˜å³°çš„éç¨‹å……æ»¿ï¼ˆ", text_after: "ï¼‰ï¼Œä½†é¢¨æ™¯å»ç„¡é™å¥½ã€‚", answer: "è‰±è¾›", explanation: "è‰±è¾›: è‰±é›£è¾›è‹¦ã€‚" },
                { text_before: "17. æˆ‘å€‘ä¸èƒ½ï¼ˆ", text_after: "ï¼‰çˆ¶æ¯çš„æœŸæœ›ï¼Œè¦åŠªåŠ›å‘ä¸Šã€‚", answer: "è¾œè² ", explanation: "è¾œè² : å°ä¸ä½åˆ¥äººçš„å¥½æ„ã€æœŸæœ›æˆ–å¹«åŠ©ã€‚" },
                { text_before: "18. ä»–åœ¨åœ‹ç•«è—è¡“æ–¹é¢ï¼ˆ", text_after: "ï¼‰å¤šå¹´ï¼Œé€ è©£é —æ·±ã€‚", answer: "æµ¸æ·«", explanation: "æµ¸æ·«: é•·æ™‚é–“æ²‰æµ¸åœ¨æŸç¨®ç’°å¢ƒæˆ–å­¸å•ä¸­ã€‚" },
                { text_before: "19. è¨˜è€…å€‘å‰å¾€ç½å€ï¼ˆ", text_after: "ï¼‰å—ç½çš„å±…æ°‘ã€‚", answer: "è¨ªå•", explanation: "è¨ªå•: ç‚ºç‰¹å®šç›®çš„è€Œæ¢æœ›ä¸¦äº¤è«‡ã€‚" },
                { text_before: "20. ä»–å€‘ä¹‹é–“ç”¢ç”Ÿäº†ï¼ˆ", text_after: "ï¼‰ï¼Œéœ€è¦å¥½å¥½æºé€šæ‰èƒ½åŒ–è§£ã€‚", answer: "èª¤è§£", explanation: "èª¤è§£: ç†è§£å¾—ä¸æ­£ç¢ºã€‚" },
                { text_before: "21. å­¸ç¿’å’Œç”Ÿæ´»æ˜¯ï¼ˆ", text_after: "ï¼‰çš„ï¼Œæˆ‘å€‘è¦æ³¨æ„å‡è¡¡ç™¼å±•ã€‚", answer: "æ¯æ¯ç›¸é—œ", explanation: "æ¯æ¯ç›¸é—œ: å‘¼å¸æ™‚æ°£æ¯ç›¸é€£çºŒã€‚å½¢å®¹é—œä¿‚éå¸¸å¯†åˆ‡ã€‚" },
                { text_before: "22. ç‚ºäº†å®Œæˆé€™å€‹é …ç›®ï¼Œä»–ï¼ˆ", text_after: "ï¼‰ï¼Œå»¢å¯¢å¿˜é£Ÿã€‚", answer: "åŸ‹é ­è‹¦å¹¹", explanation: "åŸ‹é ­è‹¦å¹¹: å°ˆå¿ƒä¸€æ„åœ°åˆ»è‹¦å·¥ä½œã€‚" },
                { text_before: "23. åœ¨å¯’å†·çš„å†¬å¤©ï¼Œä¸€æ¯ç†±èŒ¶çœŸæ˜¯ï¼ˆ", text_after: "ï¼‰ã€‚", answer: "é›ªä¸­é€ç‚­", explanation: "é›ªä¸­é€ç‚­: åœ¨ä¸‹é›ªå¤©çµ¦äººé€ç‚­å–æš–ã€‚æ¯”å–»åœ¨åˆ¥äººæ€¥éœ€æ™‚çµ¦ä»¥ç‰©è³ªä¸Šæˆ–ç²¾ç¥ä¸Šçš„å¹«åŠ©ã€‚" }
            ],
            hard: [
                { text_before: "1. ä»–è¢«æ‰“å¾—ï¼ˆ", text_after: "ï¼‰ï¼Œæ¨£å­ååˆ†ç‹¼ç‹½ã€‚", answer: "è‡‰è…«é¡é’", explanation: "è‡‰è…«é¡é’: å½¢å®¹è¢«æ‰“çš„æ…˜ç‹€ã€‚ä¹Ÿä½œã€Œé¼»é’è‡‰è…«ã€ã€‚" },
                { text_before: "2. å°æ˜å’Œå°ç´…åœ¨èˆæœƒä¸Šï¼ˆ", text_after: "ï¼‰ï¼Œå¾ˆå¿«ä¾¿æˆç‚ºäº†å¥½æœ‹å‹ã€‚", answer: "ä¸€è¦‹é¾æƒ…", explanation: "ä¸€è¦‹é¾æƒ…: æŒ‡ç”·å¥³ä¹‹é–“ä¸€è¦‹é¢å°±ç”¢ç”Ÿæ„›æƒ…ã€‚ä¹Ÿå¯ç”¨æ–¼å½¢å®¹å°äº‹ç‰©ä¸€è¦‹é¢å°±éå¸¸å–œæ„›ã€‚" },
                { text_before: "3. ä»–èªªå¾—ï¼ˆ", text_after: "ï¼‰ï¼Œå¥½åƒè¦ªçœ¼è¦‹éäº‹æƒ…çš„ç¶“éä¸€æ¨£ã€‚", answer: "è¨€ä¹‹é‘¿é‘¿", explanation: "è¨€ä¹‹é‘¿é‘¿: å½¢å®¹èªªè©±æœ‰çœŸæ†‘å¯¦æ“šï¼Œéå¸¸ç¢ºå¯¦ã€‚" },
                { text_before: "4. çˆºçˆºå–œæ­¡å’Œè€æœ‹å‹å€‘ï¼ˆ", text_after: "ï¼‰ï¼Œå›æ†¶å¾€äº‹ã€‚", answer: "ä¿ƒè†è«‡å¿ƒ", explanation: "ä¿ƒè†è«‡å¿ƒ: å½¢å®¹é›™æ–¹è¦ªå¯†åœ°è«‡è©±ã€‚" },
                { text_before: "5. é‚£äº›å£äººåˆ°è™•ï¼ˆ", text_after: "ï¼‰ï¼Œæœ€çµ‚é›£é€ƒæ³•ç¶²ã€‚", answer: "ç‚ºéä½œæ­¹", explanation: "ç‚ºéä½œæ­¹: åšå„ç¨®å£äº‹ã€‚" },
                { text_before: "6. æˆ‘å€‘è¦æªå‡ºéšŠä¼ä¸­çš„ï¼ˆ", text_after: "ï¼‰ï¼Œä¸èƒ½è®“ä»–å€‘å½±éŸ¿é›†é«”ã€‚", answer: "å®³ç¾£ä¹‹é¦¬", explanation: "å®³ç¾£ä¹‹é¦¬: æ¯”å–»å±å®³é›†é«”çš„äººã€‚" },
                { text_before: "7. åœ¨å±æ€¥é—œé ­ï¼Œæ¶ˆé˜²å“¡ç¸½æ˜¯ï¼ˆ", text_after: "ï¼‰ï¼Œæ‹¯æ•‘å¸‚æ°‘ã€‚", answer: "æŒºèº«è€Œå‡º", explanation: "æŒºèº«è€Œå‡º: å½¢å®¹å‹‡æ•¢åœ°ç«™å‡ºä¾†æ‰¿æ“”è²¬ä»»æˆ–ä¸»æŒæ­£ç¾©ã€‚" },
                { text_before: "8. åšå­¸å•ä¸èƒ½ï¼ˆ", text_after: "ï¼‰ï¼Œè¦å¤šèˆ‡äººäº¤æµï¼Œå¸å–ç¶“é©—ã€‚", answer: "é–‰é–€é€ è»Š", explanation: "é–‰é–€é€ è»Š: æ¯”å–»è„«é›¢å¯¦éš›ï¼Œåªæ†‘ä¸»è§€è¾¦äº‹ã€‚" },
                { text_before: "9. åŒå­¸å€‘äº¤ä¸Šä¾†çš„ä½œå“æ°´å¹³ï¼ˆ", text_after: "ï¼‰ï¼Œè€å¸«éœ€è¦ä»”ç´°è©•é¸ã€‚", answer: "å‚å·®ä¸é½Š", explanation: "å‚å·®ä¸é½Š: å½¢å®¹é•·çŸ­ã€é«˜ä½ã€å¤§å°ä¸ä¸€è‡´ã€‚ä¹Ÿç”¨ä¾†æ¯”å–»æ°´å¹³ä¸ä¸€è‡´ã€‚" },
                { text_before: "10. é›–ç„¶é£¢æ¸´é›£è€ï¼Œä½†å£«å…µå€‘é ç€ï¼ˆ", text_after: "ï¼‰çš„ä¿¡å¿µå …æŒä¸‹å»ã€‚", answer: "æœ›æ¢…æ­¢æ¸´", explanation: "æœ›æ¢…æ­¢æ¸´: æ¯”å–»ç”¨ç©ºæƒ³ä¾†å®‰æ…°è‡ªå·±ã€‚" }
            ]
        };

        const difficultySelectionDiv = document.getElementById('difficulty-selection');
        const gameContentDiv = document.getElementById('game-content');
        const gameArea = document.getElementById('game-area');
        const checkButton = document.getElementById('check-button');
        const resetLevelButton = document.getElementById('reset-level-button');
        const scoreArea = document.getElementById('score-area');
        const difficultyButtons = document.querySelectorAll('.btn-difficulty');
        const questionsCountInRoundSpan = document.getElementById('questions-count-in-round');
        const scoreProgressBarContainer = document.getElementById('score-progress-bar-container');
        const scoreProgressBar = document.getElementById('score-progress-bar');
        const perfectRoundStreakCounterDiv = document.getElementById('perfect-round-streak-counter');
        const perfectRoundStreakCountSpan = document.getElementById('perfect-round-streak-count');


        let currentQuestions = [];
        let currentDifficulty = '';
        let perfectRoundStreak = 0;
        let difficultyLabels = {
            easy: "åŸºç¤ç´š",
            medium: "é€²éšç´š",
            hard: "æŒ‘æˆ°ç´š"
        };

        function shuffleArray(array) {
            let newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function loadDifficulty(difficulty) {
            currentDifficulty = difficulty;
            let questionPool = shuffleArray(allQuestions[difficulty]);
            currentQuestions = questionPool.slice(0, Math.min(10, questionPool.length)); // Max 10 questions
            
            questionsCountInRoundSpan.textContent = currentQuestions.length;
            difficultySelectionDiv.classList.add('hidden');
            gameContentDiv.classList.remove('hidden');
            scoreProgressBarContainer.classList.add('hidden'); // Hide until answers are checked
            perfectRoundStreakCounterDiv.classList.add('hidden'); // Hide until answers are checked
            renderQuestions();
            scoreArea.innerHTML = ''; 
            document.body.style.backgroundColor = '#f0f9ff';
        }

        difficultyButtons.forEach(button => {
            button.addEventListener('click', () => {
                loadDifficulty(button.dataset.difficulty);
            });
        });

        function renderQuestions() {
            gameArea.innerHTML = '';
            currentQuestions.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-item';
                const originalQuestionNumberMatch = q.text_before.match(/^(\d+\.\s*)/);
                const questionTextOnly = originalQuestionNumberMatch ? q.text_before.substring(originalQuestionNumberMatch[0].length) : q.text_before;

                questionDiv.innerHTML = `
                    <p class="text-lg">
                        <span class="font-semibold">${index + 1}.</span> ${questionTextOnly}
                        <input type="text" class="answer-input" id="answer-${index}" data-index="${index}">
                        ${q.text_after}
                        <span class="feedback-icon" id="feedback-icon-${index}"></span>
                    </p>
                    <div class="explanation-area" id="explanation-${index}"></div>
                `;
                gameArea.appendChild(questionDiv);
            });
        }

        function checkAnswers() {
            let score = 0;
            let allCorrectInRound = true;
            currentQuestions.forEach((q, index) => {
                const inputElement = document.getElementById(`answer-${index}`);
                const feedbackIconElement = document.getElementById(`feedback-icon-${index}`);
                const explanationArea = document.getElementById(`explanation-${index}`);
                const questionItem = inputElement.closest('.question-item');

                inputElement.classList.remove('shake', 'pop'); // Clear previous animations
                questionItem.classList.remove('correct', 'incorrect');
                feedbackIconElement.className = 'feedback-icon'; 
                explanationArea.innerHTML = ''; 

                const userAnswer = inputElement.value.trim();
                if (userAnswer === q.answer) {
                    score++;
                    questionItem.classList.add('correct');
                    inputElement.classList.add('pop');
                } else {
                    allCorrectInRound = false;
                    questionItem.classList.add('incorrect');
                    inputElement.classList.add('shake');
                    explanationArea.innerHTML = `
                        <div class="explanation">
                            æ­£ç¢ºç­”æ¡ˆï¼š<span class="correct-answer">${q.answer}</span><br>
                            è§£é‡‹ï¼š${q.explanation}
                        </div>`;
                }
            });
            
            // Update score progress bar
            const scorePercentage = (score / currentQuestions.length) * 100;
            scoreProgressBar.style.width = scorePercentage + '%';
            scoreProgressBar.textContent = `${score}/${currentQuestions.length}`;
            scoreProgressBarContainer.classList.remove('hidden');

            // Update perfect round streak
            if (allCorrectInRound && currentQuestions.length > 0) {
                perfectRoundStreak++;
            } else if (!allCorrectInRound) { // Reset streak if not a perfect round
                perfectRoundStreak = 0;
            }
            perfectRoundStreakCountSpan.textContent = perfectRoundStreak;
            if (perfectRoundStreak > 0) {
                 perfectRoundStreakCounterDiv.classList.remove('hidden');
            } else {
                perfectRoundStreakCounterDiv.classList.add('hidden');
            }


            const difficultyLabel = difficultyLabels[currentDifficulty] || currentDifficulty.toUpperCase();
            let scoreMessage = `ä½ å–º <span class="font-bold text-blue-700">${difficultyLabel}</span> ç´šåˆ¥ç­”å°å’— ${score} / ${currentQuestions.length} é¡Œï¼`;
            
            if (allCorrectInRound && currentQuestions.length > 0) {
                scoreMessage += " <br><span class='text-green-500 text-xl'>å¤ªå‹å•¦ï¼Œå…¨éƒ¨ç­”å•±æ™’ï¼ä½ ä¿‚è©å½™å°åšå£«ï¼ğŸ¥³ğŸ‰</span>";
                document.body.style.backgroundColor = '#caffbf'; // Light mint green
            } else if (score >= currentQuestions.length * 0.7) { // 70% or more
                scoreMessage += " <br><span class='text-yellow-500 text-lg'>åšå¾—å¥½å¥½å‘€ï¼Œå·®å°‘å°‘å°±æ»¿åˆ†å–‡ï¼ç¹¼çºŒåŠªåŠ›ï¼ğŸ‘</span>";
                document.body.style.backgroundColor = '#fffec8'; // Light yellow
            } else if (score >= currentQuestions.length * 0.4) { // 40% or more
                 scoreMessage += " <br><span class='text-orange-500 text-lg'>å””éŒ¯å‘€ï¼Œå†æ¥å†å²ï¼Œä¸‹æ¬¡æœƒæ›´å¥½ï¼ğŸ’ª</span>";
                 document.body.style.backgroundColor = '#ffe4c4'; // Light bisque
            } else {
                 scoreMessage += " <br><span class='text-red-500 text-lg'>å””ç·Šè¦ï¼Œå¤±æ•—ä¹ƒæˆåŠŸä¹‹æ¯ï¼Œä¸‹æ¬¡å†æŒ‘æˆ°éå•¦ï¼ğŸ˜‰</span>";
                 document.body.style.backgroundColor = '#ffdddd'; // Light pink
            }
            scoreArea.innerHTML = scoreMessage;
        }

        function resetToDifficultySelection() {
            difficultySelectionDiv.classList.remove('hidden');
            gameContentDiv.classList.add('hidden');
            gameArea.innerHTML = '';
            scoreArea.innerHTML = '';
            scoreProgressBarContainer.classList.add('hidden');
            perfectRoundStreakCounterDiv.classList.add('hidden');
            currentQuestions = [];
            currentDifficulty = '';
            document.body.style.backgroundColor = '#f0f9ff'; // Reset background
        }

        checkButton.addEventListener('click', checkAnswers);
        resetLevelButton.addEventListener('click', resetToDifficultySelection);

    </script>
</body>
</html>
